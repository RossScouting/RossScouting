<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Track and Field Simulator</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    .track-container {
      position: relative;
      width: 600px;
      height: 300px;
    }
    .track {
      position: absolute;
      width: 100%;
      height: 100%;
      border: 5px solid black;
      border-radius: 50%;
      background: lightgray;
    }
    .start-line {
      position: absolute;
      width: 5px;
      height: 40px;
      background: red;
      /* This start-line is decorative only */
      left: 290px;
      top: 250px;
    }
    .runner {
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
    }
    #raceTimer {
      font-size: 20px;
      margin: 10px;
    }
    label {
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>Track and Field Simulator</h1>
  <label>Race Distance (m):
    <input type="number" id="raceDistance" value="400">
  </label>
  <label>Runner 1 Time (s):
    <input type="number" id="runner1Time" value="50">
  </label>
  <label>Runner 2 Time (s):
    <input type="number" id="runner2Time" value="55">
  </label>
  <button onclick="startRace()">Start Race</button>
  
  <div id="raceTimer">Time: 0.00s</div>
  
  <div class="track-container">
    <div class="track"></div>
    <div class="start-line"></div>
    <div class="runner" id="runner1"></div>
    <div class="runner" id="runner2" style="background: blue;"></div>
  </div>
  
  <script>
    function startRace() {
      const time1 = parseFloat(document.getElementById('runner1Time').value);
      const time2 = parseFloat(document.getElementById('runner2Time').value);
      const raceDistance = parseFloat(document.getElementById('raceDistance').value);
      
      const runner1 = document.getElementById('runner1');
      const runner2 = document.getElementById('runner2');
      const raceTimer = document.getElementById('raceTimer');
      
      // These numbers define the track geometry – they were in the original version.
      const trackWidth = 600;
      const trackHeight = 300;
      const straightLength = 200;       // length of each straight (in "progress" units)
      const curveRadiusX = 150;         // horizontal “radius” for the curves
      const curveRadiusY = 100;         // vertical “radius” for the curves
      const centerX = trackWidth / 2;   // 300
      const centerY = trackHeight / 2;  // 150
      
      // This function takes a progress value (0 to 400 for one lap) and returns {x,y} on the track.
      // (Note: The original track shape wasn’t a perfect oval, but this is what you approved originally.)
      function getPosition(progress) {
        if (progress <= 100) {
          // Bottom straight
          return { x: 50 + progress * 2, y: 130 };
        } else if (progress <= 200) {
          // First curve
          let angle = ((progress - 100) / 100) * Math.PI;
          return {
            x: centerX + curveRadiusX * Math.cos(angle - Math.PI / 2),
            y: centerY + curveRadiusY * Math.sin(angle - Math.PI / 2)
          };
        } else if (progress <= 300) {
          // Top straight
          return { x: 450 - (progress - 200) * 2, y: 30 };
        } else {
          // Second curve – modified so its directional movement isn’t inverted.
          // Instead of subtracting the cosine and sine, we reverse the angle by using a negative.
          let angle = ((progress - 300) / 100) * Math.PI;
          return {
            x: centerX + curveRadiusX * Math.cos(-angle - Math.PI / 2),
            y: centerY + curveRadiusY * Math.sin(-angle - Math.PI / 2)
          };
        }
      }
      
      // Initialize the runners at the start position (progress = 0)
      let startPos = getPosition(0);
      runner1.style.left = `${startPos.x}px`;
      runner1.style.top = `${startPos.y}px`;
      runner2.style.left = `${startPos.x}px`;
      runner2.style.top = `${startPos.y}px`;
      
      let startTime = null;
      function updateRace(timestamp) {
        if (!startTime) startTime = timestamp;
        let elapsed = (timestamp - startTime) / 1000;
        raceTimer.innerText = `Time: ${elapsed.toFixed(2)}s`;
        
        // For each runner, compute how many meters they've covered (clamped to raceDistance).
        const progress1Meters = Math.min((elapsed / time1) * raceDistance, raceDistance);
        const progress2Meters = Math.min((elapsed / time2) * raceDistance, raceDistance);
        
        // Use modulo 400 to get the position on the track for multi-lap races.
        let pos1 = getPosition(progress1Meters % 400);
        let pos2 = getPosition(progress2Meters % 400);
        
        runner1.style.left = `${pos1.x}px`;
        runner1.style.top = `${pos1.y}px`;
        runner2.style.left = `${pos2.x}px`;
        runner2.style.top = `${pos2.y}px`;
        
        // Continue animating until both runners have finished.
        if (progress1Meters < raceDistance || progress2Meters < raceDistance) {
          requestAnimationFrame(updateRace);
        }
      }
      requestAnimationFrame(updateRace);
    }
  </script>
</body>
</html>
